Dependencias:

npm install opencv.js jsqr canvas better-sqlite3 fs-extra date-fns

eejemplo de uso:
# Solo escaneo (crea /uploads)
node process_ticket.v1.mjs --scan

# Solo lectura de QR (usa /uploads â†’ /procesadosQR)
node process_ticket.v1.mjs --qr

# Solo insertar en BD (usa /procesadosQR â†’ /historico)
node process_ticket.v1.mjs --db

# Pipeline completo
node process_ticket.v1.mjs --scan --procesadoQR --db
# ğŸŸï¸ Sistema de Procesamiento de Boletos de LoterÃ­a

AutomatizaciÃ³n completa del flujo de escaneo, detecciÃ³n, lectura de QR y almacenamiento en base de datos de boletos de loterÃ­a espaÃ±oles (Primitiva, Euromillones y El Gordo).

---

## ğŸš€ CaracterÃ­sticas principales

| Etapa | DescripciÃ³n |
|-------|-------------------------------------------------------------------------------------|
| ğŸ–¨ï¸ **Escaneo (WIA)** | Captura boletos desde escÃ¡ner compatible WIA (Windows)               |
| ğŸ§  **Procesamiento con OpenCV.js** | DetecciÃ³n y recorte automÃ¡tico de boletos individuales |
| ğŸ” **Lectura QR (jsQR)** | DecodificaciÃ³n del cÃ³digo QR y anÃ¡lisis estructurado             |
| ğŸ§¾ **GeneraciÃ³n de JSON** | Crea archivos JSON normalizados con todos los datos del boleto  |
| ğŸ’¾ **Base de datos SQLite** | InserciÃ³n automÃ¡tica en tres tablas segÃºn tipo de juego       |
| ğŸ—‚ï¸ **Archivado histÃ³rico** | Mueve boletos y JSON procesados a `/src/historico`             |
| ğŸ§© **Modo modular** | Cada etapa puede ejecutarse de forma independiente                    |

---

## ğŸ“‚ Estructura del proyecto

AppBoletosLoteria/
â”‚
â”œâ”€â”€ process_ticket.v1.mjs â† Script principal (orquestador)
â”‚
â”œâ”€â”€ src/
â”œâ”€â”€ modules/
â”‚ â”œâ”€â”€ scan_boletos.js â† Escaneo WIA + recorte con OpenCV
â”‚ â”œâ”€â”€ parse_ticket_qr.js â† Lectura e interpretaciÃ³n de QR
â”‚ â””â”€â”€ boletosToDB.js â† InserciÃ³n SQLite y archivado
â”‚
â”œâ”€â”€ db/
â”‚ â””â”€â”€ boletos.db â† Base de datos SQLite
â”œâ”€â”€ logs/ â† Registros de actividad
â”œâ”€â”€ scans/ â† ImÃ¡genes sin procesar
â”œâ”€â”€ uploads/ â† Boletos recortados
â”œâ”€â”€ procesadosQR/ â† Boletos con JSON generado
â”œâ”€â”€ historico/ â† Archivos archivados (imagen + JSON)
â”œâ”€â”€ debug/ â† Capturas visuales del proceso
â””â”€â”€ temp/ â† Archivos temporales de escaneo


---

## âš™ï¸ InstalaciÃ³n

Requisitos:
- Node.js â‰¥ 18
- Windows (para escaneo WIA)
- EscÃ¡ner compatible WIA
- Python (solo si lo pide la instalaciÃ³n de canvas)

InstalaciÃ³n de dependencias:

```bash
npm install opencv.js jsqr canvas better-sqlite3 fs-extra date-fns

ğŸ§­ Modos de ejecuciÃ³n
ğŸ”¹ 1ï¸âƒ£ Escaneo y recorte de boletos y los crea en /uploads

            node process_ticket.v1.mjs --scan

ğŸ”¹ 2ï¸âƒ£ Procesamiento QR
       Lee los QR de los boletos recortados y genera su JSON estructurado en /src/procesadosQR.

            node process_ticket.v1.mjs --qr

ğŸ”¹ 3ï¸âƒ£ InserciÃ³n en base de datos
       Inserta los boletos JSON en la base de datos SQLite /src/db/boletos.db
       y mueve los archivos a /src/historico.

            node process_ticket.v1.mjs --db

ğŸ”¹ 4ï¸âƒ£ EjecuciÃ³n completa (pipeline total)
       Escaneo + lectura QR + inserciÃ³n en BD.

            node process_ticket.v1.mjs --scan --qr --db
